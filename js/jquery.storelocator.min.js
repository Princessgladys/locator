/*
* storeLocator v1.4.2 - jQuery Google Maps Store Locator Plugin
* (c) Copyright 2013, Bjorn Holine (http://www.bjornblog.com)
* Released under the MIT license
* Distance calculation function by Chris Pietschmann: http://pietschsoft.com/post/2008/02/01/Calculate-Distance-Between-Geocodes-in-C-and-JavaScript.aspx
*/

(function(a){a.fn.storeLocator=function(b){var c=a.extend({mapDiv:"map",listDiv:"loc-list",formContainerDiv:"form-container",formID:"user-location",inputID:"address",zoomLevel:12,pinColor:"fe7569",pinTextColor:"000000",lengthUnit:"m",storeLimit:26,distanceAlert:60,dataType:"xml",dataLocation:"locations.xml",listColor1:"ffffff",listColor2:"eeeeee",originMarker:false,originpinColor:"blue",bounceMarker:true,slideMap:true,modalWindow:false,overlayDiv:"overlay",modalWindowDiv:"modal-window",modalContentDiv:"modal-content",modalCloseIconDiv:"close-icon",defaultLoc:false,defaultLat:"",defaultLng:"",autoGeocode:false,maxDistance:false,maxDistanceID:"maxdistance",fullMapStart:false,noForm:false,loading:false,loadingDiv:"loading-map",infowindowTemplatePath:"templates/infowindow-description.html",listTemplatePath:"templates/location-list-description.html",KMLinfowindowTemplatePath:"templates/kml-infowindow-description.html",KMLlistTemplatePath:"templates/kml-location-list-description.html",callbackBeforeSend:null,callbackComplete:null,callbackSuccess:null,callbackModalOpen:null,callbackModalClose:null},b);
return this.each(function(){var h=a(this);var e,g;f();function f(){if(c.dataType==="kml"){a.get(c.KMLinfowindowTemplatePath,function(i){var j=i;g=Handlebars.compile(j);
});a.get(c.KMLlistTemplatePath,function(i){var j=i;e=Handlebars.compile(j);d();});}else{a.get(c.infowindowTemplatePath,function(i){var j=i;g=Handlebars.compile(j);
});a.get(c.listTemplatePath,function(i){var j=i;e=Handlebars.compile(j);d();});}}function d(){var v,w,y,s,l,t;var q=[];if(c.modalWindow===true){h.wrap('<div id="'+c.overlayDiv+'"><div id="'+c.modalWindowDiv+'"><div id="'+c.modalContentDiv+'">');
a("#"+c.modalWindowDiv).prepend('<div id="'+c.modalCloseIconDiv+'"></div>');a("#"+c.overlayDiv).hide();}if(c.slideMap===true){h.hide();}var x={};if(c.lengthUnit==="km"){x.EarthRadius=6367;
}else{x.EarthRadius=3956;}x.ToRadian=function(r){return r*(Math.PI/180);};x.DiffRadian=function(A,r){return x.ToRadian(r)-x.ToRadian(A);};x.CalcDistance=function(D,C,B,A,r){return r*2*Math.asin(Math.min(1,Math.sqrt((Math.pow(Math.sin((x.DiffRadian(D,B))/2),2)+Math.cos(x.ToRadian(D))*Math.cos(x.ToRadian(B))*Math.pow(Math.sin((x.DiffRadian(C,A))/2),2)))));
};function u(){geocoder=new google.maps.Geocoder();this.geocode=function(r,A){geocoder.geocode({address:r},function(D,C){if(C==google.maps.GeocoderStatus.OK){var B={};
B.latitude=D[0].geometry.location.lat();B.longitude=D[0].geometry.location.lng();A(B);}else{alert("Geocode was not successful for the following reason: "+C);
A(null);}});};}function z(){geocoder=new google.maps.Geocoder();this.geocode=function(A,r){geocoder.geocode({latLng:A},function(D,C){if(C==google.maps.GeocoderStatus.OK){if(D[0]){var B={};
B.address=D[0].formatted_address;r(B);}}else{alert("Geocode was not successful for the following reason: "+C);r(null);}});};}function o(A,B){var r=Math.round(A*Math.pow(10,B))/Math.pow(10,B);
return r;}if(c.defaultLoc===true){var j=new z();var k=new google.maps.LatLng(c.defaultLat,c.defaultLng);j.geocode(k,function(A){if(A!==null){var r=A.address;
i(c.defaultLat,c.defaultLng,r);}else{alert("Unable to find address");}});}if(c.fullMapStart===true){i();}if(c.autoGeocode===true){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(n,m);
}}function n(A){var B=new z();var C=new google.maps.LatLng(A.coords.latitude,A.coords.longitude);B.geocode(C,function(D){if(D!==null){var r=D.address;i(A.coords.latitude,A.coords.longitude,r);
}else{alert("Unable to find address");}});}function m(r){alert("Automatic location detection failed. Please fill in your address or zip code.");}function p(C){var B=a("#"+c.inputID).val();
if(B===""){alert("The input box was blank.");}else{var A=new u();var r=B;A.geocode(r,function(D){if(D!==null){w=D.latitude;y=D.longitude;i(w,y,B,C);}else{alert("ERROR! Unable to geocode address");
}});}}a(function(){function r(B){B.preventDefault();if(c.maxDistance===true){var A=a("#"+c.maxDistanceID).val();p(A);}else{p();}}if(c.noForm===true){a(document).on("click","#"+c.formContainerDiv+" #submit",function(A){r(A);
});a(document).keyup(function(A){if(A.keyCode===13){r(A);}});}else{a(document).on("submit","#"+c.formID,function(A){r(A);});}});function i(r,B,A,C){a(function(){var D;
q=[];if(c.dataType==="kml"){D="xml";}else{D=c.dataType;}a.ajax({type:"GET",url:c.dataLocation+(c.dataType==="jsonp"?(c.dataLocation.match(/\?/)?"&":"?")+"callback=?":""),dataType:D,beforeSend:function(){if(c.callbackBeforeSend){c.callbackBeforeSend.call(this);
}if(c.loading===true){a("#"+c.formContainerDiv).append('<div id="'+c.loadingDiv+'"></div>');}},complete:function(G,F,E){if(c.callbackComplete){c.callbackComplete.call(this,G,F,E);
}if(c.loading===true){a("#"+c.loadingDiv).remove();}},success:function(G,I,E){if(c.callbackSuccess){c.callbackSuccess.call(this,G,I,E);}var F=0;var H;if(c.fullMapStart===true&&a("#"+c.mapDiv).hasClass("mapOpen")===false){H=true;
}a("#"+c.mapDiv).addClass("mapOpen");if(c.dataType==="json"||c.dataType==="jsonp"){a.each(G,function(){var M=this.locname;var U=this.lat;var V=this.lng;
var W=this.address;var L=this.address2;var Q=this.city;var K=this.state;var S=this.postal;var T=this.phone;var R=this.web;R=R.replace("http://","");var P=this.hours1;
var O=this.hours2;var N=this.hours3;var J=x.CalcDistance(r,B,U,V,x.EarthRadius);if(c.maxDistance===true&&H!==true){if(J<C){q[F]=[J,M,U,V,W,L,Q,K,S,T,R,P,O,N];
}else{return;}}else{q[F]=[J,M,U,V,W,L,Q,K,S,T,R,P,O,N];}F++;});}else{if(c.dataType==="kml"){a(G).find("Placemark").each(function(){var K=a(this).find("name").text();
var M=a(this).find("coordinates").text().split(",")[1];var J=a(this).find("coordinates").text().split(",")[0];var L=a(this).find("description").text();
var N=x.CalcDistance(r,B,M,J,x.EarthRadius);if(c.maxDistance===true&&H!==true){if(N<C){q[F]=[N,K,M,J,L];}else{return;}}else{q[F]=[N,K,M,J,L];}F++;});}else{a(G).find("marker").each(function(){var M=a(this).attr("name");
var U=a(this).attr("lat");var V=a(this).attr("lng");var W=a(this).attr("address");var L=a(this).attr("address2");var Q=a(this).attr("city");var K=a(this).attr("state");
var S=a(this).attr("postal");var T=a(this).attr("phone");var R=a(this).attr("web");R=R.replace("http://","");var P=a(this).attr("hours1");var O=a(this).attr("hours2");
var N=a(this).attr("hours3");var J=x.CalcDistance(r,B,U,V,x.EarthRadius);if(c.maxDistance===true&&H!==true){if(J<C){q[F]=[J,M,U,V,W,L,Q,K,S,T,R,P,O,N];
}else{return;}}else{q[F]=[J,M,U,V,W,L,Q,K,S,T,R,P,O,N];}F++;});}}q.sort(function(L,K){var J=L[0];var M=K[0];return((J<M)?-1:((J>M)?1:0));});if(c.maxDistance===true&&H!==true){if(q[0]===undefined||q[0][0]>C){alert("Unfortunately, our closest location is more than "+C+" miles away.");
return;}}else{if(q[0][0]>c.distanceAlert){alert("Unfortunately, our closest location is more than "+c.distanceAlert+" miles away.");}}a(function(){var an,af,ad,ab,R,ai,K,ak,S,aa,Y,X,ah;
function T(ao){an=q[ao][0];an=o(an,2);af=q[ao][1];ad=q[ao][4];ab=q[ao][5];R=q[ao][6];ai=q[ao][7];K=q[ao][8];ak=q[ao][9];S=q[ao][10];aa=q[ao][11];Y=q[ao][12];
X=q[ao][13];}function V(ao){an=q[ao][0];an=o(an,2);af=q[ao][1];ah=q[ao][4];}function M(at){if(c.dataType==="kml"){V(at.get("id"));}else{T(at.get("id"));
}var aq;if(an<=1){if(c.lengthUnit==="km"){aq="kilometer";}else{aq="mile";}}else{if(c.lengthUnit==="km"){aq="kilometers";}else{aq="miles";}}var ar=at.get("id");
if(c.storeLimit>26){var ap=ar+1;}else{var ap=String.fromCharCode("A".charCodeAt(0)+ar);}if(c.dataType==="kml"){var ao={location:[{distance:an,markerid:ar,marker:ap,name:af,description:ah,length:aq,origin:A}]};
}else{var ao={location:[{distance:an,markerid:ar,marker:ap,name:af,address:ad,address2:ab,city:R,state:ai,postal:K,phone:ak,web:S,hours1:aa,hours2:Y,hours3:X,length:aq,origin:A}]};
}return ao;}if(c.slideMap===true){h.slideDown();}if(c.modalWindow===true){if(c.callbackModalOpen){c.callbackModalOpen.call(this);}function L(){if(c.callbackModalOpen){c.callbackModalOpen.call(this);
}a("#"+c.overlayDiv).hide();}a("#"+c.overlayDiv).fadeIn();a(document).on("click","#"+c.modalCloseIconDiv+", #"+c.overlayDiv,function(){L();});a(document).on("click","#"+c.modalWindowDiv,function(ao){ao.stopPropagation();
});a(document).keyup(function(ao){if(ao.keyCode===27){L();}});}if((c.fullMapStart===true&&H===true)||c.zoomLevel===0){var ac={mapTypeId:google.maps.MapTypeId.ROADMAP};
var P=new google.maps.LatLngBounds();}else{var ac={zoom:c.zoomLevel,center:new google.maps.LatLng(r,B),mapTypeId:google.maps.MapTypeId.ROADMAP};}var al=new google.maps.Map(document.getElementById(c.mapDiv),ac);
var aj=[];var W=new google.maps.InfoWindow();if((q.length-1)<c.storeLimit-1){t=q.length-1;}else{t=c.storeLimit-1;}if(c.originMarker===true&&c.fullMapStart===false){var O=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));
var Z=new google.maps.LatLng(r,B);var Q=new google.maps.Marker({position:Z,map:al,icon:"http://maps.google.com/mapfiles/ms/icons/"+c.originpinColor+"-dot.png",shadow:O,draggable:false});
}for(var U=0;U<=t;U++){var am=String.fromCharCode("A".charCodeAt(0)+U);var ag=new google.maps.LatLng(q[U][2],q[U][3]);Q=J(ag,q[U][1],q[U][4],am);Q.set("id",U);
aj[U]=Q;if((c.fullMapStart===true&&H===true)||c.zoomLevel===0){P.extend(ag);}N(Q);}if((c.fullMapStart===true&&H===true)||c.zoomLevel===0){al.fitBounds(P);
}a("#"+c.listDiv+" ul").empty();a(aj).each(function(ao,ap){var aq=String.fromCharCode("A".charCodeAt(0)+ao);var ar=aj[ao];ae(ar);});function ae(ap){var ao=M(ap);
var aq=e(ao);a("#"+c.listDiv+" ul").append(aq);}a(document).on("click","#"+c.listDiv+" li",function(){var aq=a(this).data("markerid");var ap=aj[aq];a("#"+c.listDiv+" li").removeClass("list-focus");
a("#"+c.listDiv+" li[data-markerid="+aq+"]").addClass("list-focus");al.panTo(ap.getPosition());var ao="left";if(c.bounceMarker===true){ap.setAnimation(google.maps.Animation.BOUNCE);
setTimeout(function(){ap.setAnimation(null);N(ap,ao);},700);}else{N(ap,ao);}});a("#"+c.listDiv+" ul li:even").css("background","#"+c.listColor1);a("#"+c.listDiv+" ul li:odd").css("background","#"+c.listColor2);
function J(ao,ar,aq,av){var au=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+av+"|"+c.pinColor+"|"+c.pinTextColor,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34));
var at=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));
if(c.storeLimit>26){var ap=new google.maps.Marker({position:ao,map:al,draggable:false});}else{var ap=new google.maps.Marker({position:ao,map:al,icon:au,shadow:at,draggable:false});
}return ap;}function N(ar,aq){var ap=M(ar);var ao=g(ap);if(aq==="left"){W.setContent(ao);W.open(ar.get(c.mapDiv),ar);}else{google.maps.event.addListener(ar,"click",function(){W.setContent(ao);
W.open(ar.get(c.mapDiv),ar);a("#"+c.listDiv+" li").removeClass("list-focus");markerId=ar.get("id");a("#"+c.listDiv+" li[data-markerid="+markerId+"]").addClass("list-focus");
var at=a("#"+c.listDiv),au=a("#"+c.listDiv+" li[data-markerid="+markerId+"]");a("#"+c.listDiv).animate({scrollTop:au.offset().top-at.offset().top+at.scrollTop()});
});}}});}});});}}});};})(jQuery);